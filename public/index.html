<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Team Orchestrator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --bg-card: #ffffff;
      --bg-elevated: #f1f5f9;
      --border-color: #e2e8f0;
      --border-hover: #cbd5e1;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-muted: #94a3b8;
      --accent-primary: #3b82f6;
      --accent-secondary: #0891b2;
      --accent-success: #10b981;
      --accent-warning: #f59e0b;
      --accent-danger: #ef4444;
      --glow-primary: rgba(59, 130, 246, 0.08);
      --glow-cyan: rgba(8, 145, 178, 0.08);
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-secondary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Subtle top gradient */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 300px;
      background: linear-gradient(180deg, rgba(59, 130, 246, 0.03) 0%, transparent 100%);
      pointer-events: none;
      z-index: 0;
    }

    .header {
      position: relative;
      z-index: 10;
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border-color);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow-sm);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      box-shadow: 0 4px 16px var(--glow-primary);
    }

    .logo-text h1 {
      font-size: 1.125rem;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .logo-text p {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .stats {
      display: flex;
      gap: 0.5rem;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 0.75rem 1.25rem;
      min-width: 100px;
      transition: all 0.2s ease;
    }

    .stat-card:hover {
      border-color: var(--border-hover);
      transform: translateY(-2px);
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--text-primary), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .stat-label {
      font-size: 0.6875rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .main {
      position: relative;
      z-index: 1;
      display: flex;
      height: calc(100vh - 73px);
    }

    .sidebar {
      width: 280px;
      background: var(--bg-primary);
      border-right: 1px solid var(--border-color);
      padding: 1.5rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .sidebar-section {
      margin-bottom: 1.5rem;
    }

    .sidebar-title {
      font-size: 0.6875rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .agent-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .agent-item {
      padding: 0.75rem;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .agent-item:hover {
      border-color: var(--accent-primary);
      background: var(--bg-elevated);
      transform: translateX(4px);
    }

    .agent-avatar {
      width: 38px;
      height: 38px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      background: var(--bg-elevated);
      border: 1px solid var(--border-color);
    }

    .agent-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .agent-avatar.manager {
      border-color: #a5b4fc;
      background: #eef2ff;
    }
    .agent-avatar.specialist {
      border-color: #93c5fd;
      background: #eff6ff;
    }
    .agent-avatar.support {
      border-color: #6ee7b7;
      background: #ecfdf5;
    }

    .agent-status {
      position: absolute;
      bottom: -2px;
      right: -2px;
      width: 12px;
      height: 12px;
      background: var(--accent-success);
      border: 2px solid var(--bg-card);
      border-radius: 50%;
    }

    .agent-info h3 {
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 0.125rem;
    }

    .agent-info p {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: capitalize;
    }

    .run-agent-panel {
      margin-top: auto;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 1rem;
    }

    .run-agent-panel h3 {
      font-size: 0.8125rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .run-agent-form {
      display: flex;
      flex-direction: column;
      gap: 0.625rem;
    }

    .run-agent-form select,
    .run-agent-form input {
      padding: 0.625rem 0.75rem;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 0.8125rem;
      font-family: inherit;
      transition: all 0.2s ease;
    }

    .run-agent-form select:focus,
    .run-agent-form input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px var(--glow-primary);
    }

    .run-agent-form button {
      padding: 0.625rem 1rem;
      background: linear-gradient(135deg, var(--accent-primary), #2563eb);
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 0.8125rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .run-agent-form button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 16px var(--glow-primary);
    }

    .run-agent-form button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .kanban {
      flex: 1;
      display: flex;
      gap: 1rem;
      padding: 1.5rem;
      overflow-x: auto;
    }

    .column {
      min-width: 300px;
      max-width: 320px;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      transition: all 0.2s ease;
      box-shadow: var(--shadow-sm);
    }

    .column:hover {
      box-shadow: var(--shadow-md);
    }

    .column-header {
      padding: 1rem 1.25rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .column-header h3 {
      font-size: 0.8125rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.625rem;
    }

    .column-count {
      background: var(--bg-elevated);
      padding: 0.25rem 0.625rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      box-shadow: 0 0 8px currentColor;
    }

    .status-dot.backlog { color: #64748b; background: #64748b; }
    .status-dot.ready { color: var(--accent-secondary); background: var(--accent-secondary); }
    .status-dot.in_progress { color: var(--accent-warning); background: var(--accent-warning); }
    .status-dot.done { color: var(--accent-success); background: var(--accent-success); }

    .column-body {
      flex: 1;
      padding: 0.75rem;
      overflow-y: auto;
      min-height: 200px;
    }

    .task-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 0.625rem;
      cursor: grab;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .task-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--accent-primary);
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .task-card:hover {
      border-color: var(--border-hover);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .task-card:hover::before {
      opacity: 1;
    }

    .task-card.dragging {
      opacity: 0.5;
      transform: rotate(2deg);
    }

    .task-priority {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      font-size: 0.625rem;
      font-weight: 700;
      margin-bottom: 0.625rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .priority-P0 {
      background: #fef2f2;
      color: #dc2626;
      border: 1px solid #fecaca;
    }
    .priority-P1 {
      background: #fffbeb;
      color: #d97706;
      border: 1px solid #fde68a;
    }
    .priority-P2 {
      background: #eff6ff;
      color: #2563eb;
      border: 1px solid #bfdbfe;
    }
    .priority-P3 {
      background: #f8fafc;
      color: #64748b;
      border: 1px solid #e2e8f0;
    }

    .task-title {
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      line-height: 1.4;
      color: var(--text-primary);
    }

    .task-description {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 0.75rem;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      line-height: 1.5;
    }

    .task-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 0.75rem;
      border-top: 1px solid var(--border-color);
    }

    .task-owner {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .owner-avatar {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-color);
      object-fit: cover;
    }

    .task-actions {
      display: flex;
      gap: 0.25rem;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .task-card:hover .task-actions {
      opacity: 1;
    }

    .task-action-btn {
      background: var(--bg-elevated);
      border: 1px solid var(--border-color);
      color: var(--text-muted);
      cursor: pointer;
      padding: 0.375rem;
      border-radius: 6px;
      transition: all 0.2s ease;
      font-size: 0.75rem;
    }

    .task-action-btn:hover {
      color: var(--accent-danger);
      border-color: var(--accent-danger);
      background: rgba(239, 68, 68, 0.1);
    }

    .add-task-btn {
      width: 100%;
      padding: 0.75rem;
      background: transparent;
      border: 2px dashed var(--border-color);
      border-radius: 10px;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 0.8125rem;
      font-weight: 500;
      transition: all 0.2s ease;
      margin: 0.75rem;
      margin-top: 0;
    }

    .add-task-btn:hover {
      border-color: var(--accent-primary);
      color: var(--accent-primary);
      background: var(--glow-primary);
    }

    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(15, 23, 42, 0.4);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      z-index: 100;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      padding: 2rem;
      width: 100%;
      max-width: 480px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
    }

    .modal h2 {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-group label {
      display: block;
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 0.75rem 1rem;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 0.875rem;
      font-family: inherit;
      transition: all 0.2s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px var(--glow-primary);
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      margin-top: 2rem;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 10px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
    }

    .btn-secondary {
      background: var(--bg-elevated);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
    }

    .btn-secondary:hover {
      background: var(--bg-card);
      border-color: var(--border-hover);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-primary), #2563eb);
      border: none;
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 16px var(--glow-primary);
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid var(--border-color);
      border-top-color: var(--accent-primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 0.75rem;
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--border-hover);
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 2rem 1rem;
      color: var(--text-muted);
    }

    .empty-state-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      opacity: 0.5;
    }

    .empty-state-text {
      font-size: 0.75rem;
    }

    /* Agent Detail Modal */
    .agent-detail-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding-bottom: 1.25rem;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 1.25rem;
    }

    .agent-detail-avatar {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: var(--bg-elevated);
      border: 2px solid var(--border-color);
    }

    .agent-detail-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .agent-detail-info {
      flex: 1;
    }

    .agent-detail-info h3 {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
      text-transform: capitalize;
    }

    .agent-detail-role {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      background: var(--bg-elevated);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-transform: capitalize;
    }

    .btn-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .btn-icon:hover {
      border-color: var(--accent-primary);
      color: var(--accent-primary);
      background: var(--glow-primary);
    }

    .agent-detail-section {
      margin-bottom: 1.25rem;
    }

    .agent-detail-section h4 {
      font-size: 0.8125rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 0.75rem;
    }

    .skills-list, .tools-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .skill-tag, .tool-tag {
      padding: 0.375rem 0.75rem;
      background: var(--bg-elevated);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 0.75rem;
      color: var(--text-primary);
      transition: all 0.2s ease;
    }

    .skill-tag:hover {
      border-color: var(--accent-primary);
      background: var(--glow-primary);
    }

    .tool-tag {
      background: #ecfeff;
      border-color: #a5f3fc;
      color: #0891b2;
    }

    .prompt-preview {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 1rem;
      font-size: 0.75rem;
      color: var(--text-muted);
      max-height: 120px;
      overflow-y: auto;
      font-family: 'Monaco', 'Menlo', monospace;
      line-height: 1.5;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="logo">
      <div class="logo-icon">ü§ñ</div>
      <div class="logo-text">
        <h1>AI Team Orchestrator</h1>
        <p>Multi-agent task management</p>
      </div>
    </div>
    <div class="stats">
      <div class="stat-card">
        <div class="stat-value" id="total-tasks">0</div>
        <div class="stat-label">Total Tasks</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="in-progress-tasks">0</div>
        <div class="stat-label">In Progress</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="done-tasks">0</div>
        <div class="stat-label">Completed</div>
      </div>
    </div>
  </header>

  <main class="main">
    <aside class="sidebar">
      <div class="sidebar-section">
        <h2 class="sidebar-title">
          <span>üë•</span> Team Agents
        </h2>
        <ul class="agent-list" id="agent-list">
          <li class="loading"><div class="spinner"></div> Loading agents...</li>
        </ul>
      </div>

      <div class="run-agent-panel">
        <h3>‚ö° Quick Run</h3>
        <form class="run-agent-form" id="run-agent-form">
          <select id="agent-select" required>
            <option value="">Select agent...</option>
          </select>
          <input type="text" id="task-input" placeholder="Describe the task..." required>
          <button type="submit">Run Agent</button>
        </form>
      </div>
    </aside>

    <div class="kanban" id="kanban">
      <div class="column" data-status="backlog">
        <div class="column-header">
          <h3><span class="status-dot backlog"></span> Backlog</h3>
          <span class="column-count" id="count-backlog">0</span>
        </div>
        <div class="column-body" id="tasks-backlog"></div>
        <button class="add-task-btn" onclick="openAddTaskModal('backlog')">+ Add Task</button>
      </div>

      <div class="column" data-status="ready">
        <div class="column-header">
          <h3><span class="status-dot ready"></span> Ready</h3>
          <span class="column-count" id="count-ready">0</span>
        </div>
        <div class="column-body" id="tasks-ready"></div>
      </div>

      <div class="column" data-status="in_progress">
        <div class="column-header">
          <h3><span class="status-dot in_progress"></span> In Progress</h3>
          <span class="column-count" id="count-in_progress">0</span>
        </div>
        <div class="column-body" id="tasks-in_progress"></div>
      </div>

      <div class="column" data-status="done">
        <div class="column-header">
          <h3><span class="status-dot done"></span> Done</h3>
          <span class="column-count" id="count-done">0</span>
        </div>
        <div class="column-body" id="tasks-done"></div>
      </div>
    </div>
  </main>

  <!-- Agent Details Modal -->
  <div class="modal-overlay" id="agent-modal">
    <div class="modal" style="max-width: 560px;">
      <h2 id="agent-modal-title">ü§ñ Agent Details</h2>
      <div id="agent-modal-content">
        <div class="agent-detail-header">
          <div class="agent-detail-avatar" id="agent-detail-avatar">‚ö°</div>
          <div class="agent-detail-info">
            <h3 id="agent-detail-name">Agent Name</h3>
            <span class="agent-detail-role" id="agent-detail-role">specialist</span>
          </div>
          <button class="btn-icon" id="edit-agent-btn" title="Edit Agent">‚úèÔ∏è</button>
        </div>

        <div class="agent-detail-section">
          <h4>üìã Capabilities</h4>
          <div class="skills-list" id="agent-skills"></div>
        </div>

        <div class="agent-detail-section">
          <h4>üõ†Ô∏è Tools</h4>
          <div class="tools-list" id="agent-tools"></div>
        </div>

        <div class="agent-detail-section">
          <h4>üìù System Prompt</h4>
          <div class="prompt-preview" id="agent-prompt"></div>
        </div>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" onclick="closeAgentModal()">Close</button>
        <button type="button" class="btn btn-primary" onclick="runAgentFromModal()">Run Agent</button>
      </div>
    </div>
  </div>

  <!-- Add Task Modal -->
  <div class="modal-overlay" id="add-task-modal">
    <div class="modal">
      <h2>‚ú® Create New Task</h2>
      <form id="add-task-form">
        <div class="form-group">
          <label>Task Title</label>
          <input type="text" id="new-task-title" placeholder="What needs to be done?" required>
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea id="new-task-description" placeholder="Add more details..."></textarea>
        </div>
        <div class="form-group">
          <label>Assign to Agent</label>
          <select id="new-task-owner">
            <option value="">Unassigned</option>
          </select>
        </div>
        <div class="form-group">
          <label>Priority</label>
          <select id="new-task-priority">
            <option value="">None</option>
            <option value="P0">üî¥ P0 - Critical</option>
            <option value="P1">üü† P1 - High</option>
            <option value="P2">üîµ P2 - Medium</option>
            <option value="P3">‚ö™ P3 - Low</option>
          </select>
        </div>
        <input type="hidden" id="new-task-status" value="backlog">
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeAddTaskModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Create Task</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const API_BASE = '';
    const PROJECT_ID = 'default';
    let agents = [];
    let tasks = [];

    // Fetch agents
    async function fetchAgents() {
      try {
        const response = await fetch(`${API_BASE}/api/agents`);
        agents = await response.json();
        renderAgents();
        populateAgentSelects();
      } catch (error) {
        console.error('Failed to fetch agents:', error);
        document.getElementById('agent-list').innerHTML = '<li class="empty-state"><div class="empty-state-icon">‚ö†Ô∏è</div><div class="empty-state-text">Failed to load agents</div></li>';
      }
    }

    // Render agents in sidebar
    function renderAgents() {
      const agentList = document.getElementById('agent-list');
      if (agents.length === 0) {
        agentList.innerHTML = '<li class="empty-state"><div class="empty-state-icon">ü§ñ</div><div class="empty-state-text">No agents configured</div></li>';
        return;
      }

      agentList.innerHTML = agents.map(agent => `
        <li class="agent-item" onclick="openAgentModal('${agent.name}')">
          <div class="agent-avatar ${agent.role}">
            <img src="${getAgentAvatarUrl(agent.name, agent.role)}" alt="${agent.name}">
            <div class="agent-status"></div>
          </div>
          <div class="agent-info">
            <h3>${agent.name}</h3>
            <p>${agent.role}</p>
          </div>
        </li>
      `).join('');
    }

    // Generate DiceBear avatar URL based on agent name and role
    function getAgentAvatarUrl(name, role) {
      // Use different styles for different roles
      const styles = {
        manager: 'notionists',
        specialist: 'bottts-neutral',
        support: 'lorelei'
      };
      const style = styles[role] || 'bottts-neutral';
      const seed = encodeURIComponent(name);
      return `https://api.dicebear.com/9.x/${style}/svg?seed=${seed}&backgroundColor=transparent`;
    }

    // Get avatar URL for task owner (lookup agent role)
    function getOwnerAvatarUrl(ownerName) {
      const agent = agents.find(a => a.name === ownerName);
      const role = agent ? agent.role : 'specialist';
      return getAgentAvatarUrl(ownerName, role);
    }

    // Agent modal
    let selectedAgentName = null;

    function openAgentModal(agentName) {
      const agent = agents.find(a => a.name === agentName);
      if (!agent) return;

      selectedAgentName = agentName;

      // Set header
      document.getElementById('agent-modal-title').innerHTML = `<img src="${getAgentAvatarUrl(agent.name, agent.role)}" style="width:24px;height:24px;border-radius:6px;vertical-align:middle;margin-right:8px;">${agent.name}`;
      document.getElementById('agent-detail-avatar').innerHTML = `<img src="${getAgentAvatarUrl(agent.name, agent.role)}" alt="${agent.name}">`;
      document.getElementById('agent-detail-name').textContent = agent.name;
      document.getElementById('agent-detail-role').textContent = agent.role;

      // Extract capabilities from system prompt
      const capabilities = extractCapabilities(agent.systemPrompt);
      document.getElementById('agent-skills').innerHTML = capabilities.length > 0
        ? capabilities.map(c => `<span class="skill-tag">${c}</span>`).join('')
        : '<span style="color: var(--text-muted); font-size: 0.75rem;">No capabilities defined</span>';

      // Extract tools from system prompt
      const tools = extractTools(agent.systemPrompt);
      document.getElementById('agent-tools').innerHTML = tools.length > 0
        ? tools.map(t => `<span class="tool-tag">${t}</span>`).join('')
        : '<span style="color: var(--text-muted); font-size: 0.75rem;">Default tools</span>';

      // Show prompt preview (first 300 chars)
      const promptPreview = agent.systemPrompt ? agent.systemPrompt.substring(0, 400) + '...' : 'No system prompt';
      document.getElementById('agent-prompt').textContent = promptPreview;

      document.getElementById('agent-modal').classList.add('active');
    }

    function closeAgentModal() {
      document.getElementById('agent-modal').classList.remove('active');
      selectedAgentName = null;
    }

    function runAgentFromModal() {
      if (selectedAgentName) {
        closeAgentModal();
        document.getElementById('agent-select').value = selectedAgentName;
        document.getElementById('task-input').focus();
      }
    }

    function extractCapabilities(prompt) {
      if (!prompt) return [];
      const capMatch = prompt.match(/## Capabilities\s*([\s\S]*?)(?=##|$)/i);
      if (!capMatch) return [];
      const lines = capMatch[1].split('\n').filter(l => l.trim().startsWith('-'));
      return lines.slice(0, 6).map(l => l.replace(/^-\s*/, '').trim()).filter(Boolean);
    }

    function extractTools(prompt) {
      if (!prompt) return [];
      const toolMatch = prompt.match(/## Tech Stack[^#]*|## Tools[^#]*/i);
      if (!toolMatch) return ['Read', 'Write', 'Bash', 'Grep'];
      const lines = toolMatch[0].split('\n').filter(l => l.trim().startsWith('-'));
      return lines.slice(0, 5).map(l => l.replace(/^-\s*/, '').split('/')[0].trim()).filter(Boolean);
    }

    // Close agent modal on overlay click
    document.getElementById('agent-modal').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) closeAgentModal();
    });

    // Populate agent selects
    function populateAgentSelects() {
      const selects = [document.getElementById('agent-select'), document.getElementById('new-task-owner')];
      selects.forEach(select => {
        if (!select) return;
        const currentValue = select.value;
        const options = select.id === 'agent-select'
          ? '<option value="">Select agent...</option>'
          : '<option value="">Unassigned</option>';
        select.innerHTML = options + agents.map(a =>
          `<option value="${a.name}">${a.name} (${a.role})</option>`
        ).join('');
        select.value = currentValue;
      });
    }

    // Fetch tasks
    async function fetchTasks() {
      try {
        const response = await fetch(`${API_BASE}/api/projects/${PROJECT_ID}/tasks`);
        tasks = await response.json();
        renderTasks();
        updateStats();
      } catch (error) {
        console.error('Failed to fetch tasks:', error);
      }
    }

    // Render tasks in Kanban columns
    function renderTasks() {
      const statuses = ['backlog', 'ready', 'in_progress', 'done'];
      statuses.forEach(status => {
        const container = document.getElementById(`tasks-${status}`);
        const statusTasks = tasks.filter(t => t.status === status);
        document.getElementById(`count-${status}`).textContent = statusTasks.length;

        if (statusTasks.length === 0) {
          container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">${status === 'done' ? 'üéâ' : 'üìã'}</div><div class="empty-state-text">${status === 'done' ? 'No completed tasks' : 'No tasks here'}</div></div>`;
          return;
        }

        container.innerHTML = statusTasks.map(task => `
          <div class="task-card" draggable="true" data-task-id="${task.id}"
               ondragstart="dragStart(event)" ondragend="dragEnd(event)">
            ${task.priority ? `<span class="task-priority priority-${task.priority}">${task.priority}</span>` : ''}
            <div class="task-title">${escapeHtml(task.title)}</div>
            ${task.description ? `<div class="task-description">${escapeHtml(task.description)}</div>` : ''}
            <div class="task-footer">
              <div class="task-owner">
                ${task.owner ? `<img class="owner-avatar" src="${getOwnerAvatarUrl(task.owner)}" alt="${task.owner}">${task.owner}` : '<span style="color: var(--text-muted);">Unassigned</span>'}
              </div>
              <div class="task-actions">
                <button class="task-action-btn" onclick="deleteTask('${task.id}')" title="Delete">üóëÔ∏è</button>
              </div>
            </div>
          </div>
        `).join('');
      });

      // Set up drop zones
      document.querySelectorAll('.column-body').forEach(col => {
        col.ondragover = dragOver;
        col.ondrop = drop;
      });
    }

    // Update stats
    function updateStats() {
      document.getElementById('total-tasks').textContent = tasks.length;
      document.getElementById('in-progress-tasks').textContent = tasks.filter(t => t.status === 'in_progress').length;
      document.getElementById('done-tasks').textContent = tasks.filter(t => t.status === 'done').length;
    }

    // Drag and drop
    let draggedTaskId = null;

    function dragStart(e) {
      draggedTaskId = e.target.dataset.taskId;
      e.target.classList.add('dragging');
    }

    function dragEnd(e) {
      e.target.classList.remove('dragging');
    }

    function dragOver(e) {
      e.preventDefault();
    }

    async function drop(e) {
      e.preventDefault();
      const newStatus = e.currentTarget.id.replace('tasks-', '');
      if (draggedTaskId && newStatus) {
        await updateTaskStatus(draggedTaskId, newStatus);
      }
    }

    async function updateTaskStatus(taskId, status) {
      try {
        await fetch(`${API_BASE}/api/tasks/${taskId}`, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status })
        });
        await fetchTasks();
      } catch (error) {
        console.error('Failed to update task:', error);
      }
    }

    async function deleteTask(taskId) {
      if (!confirm('Delete this task?')) return;
      try {
        await fetch(`${API_BASE}/api/tasks/${taskId}`, { method: 'DELETE' });
        await fetchTasks();
      } catch (error) {
        console.error('Failed to delete task:', error);
      }
    }

    // Add task modal
    function openAddTaskModal(status = 'backlog') {
      document.getElementById('new-task-status').value = status;
      document.getElementById('add-task-modal').classList.add('active');
    }

    function closeAddTaskModal() {
      document.getElementById('add-task-modal').classList.remove('active');
      document.getElementById('add-task-form').reset();
    }

    document.getElementById('add-task-form').onsubmit = async (e) => {
      e.preventDefault();
      const task = {
        title: document.getElementById('new-task-title').value,
        description: document.getElementById('new-task-description').value,
        owner: document.getElementById('new-task-owner').value || undefined,
        priority: document.getElementById('new-task-priority').value || undefined,
      };

      try {
        await fetch(`${API_BASE}/api/projects/${PROJECT_ID}/tasks`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(task)
        });
        closeAddTaskModal();
        await fetchTasks();
      } catch (error) {
        console.error('Failed to create task:', error);
      }
    };

    // Run agent
    function selectAgent(agentName) {
      document.getElementById('agent-select').value = agentName;
      document.getElementById('task-input').focus();
    }

    document.getElementById('run-agent-form').onsubmit = async (e) => {
      e.preventDefault();
      const agentName = document.getElementById('agent-select').value;
      const task = document.getElementById('task-input').value;

      if (!agentName || !task) return;

      const btn = e.target.querySelector('button');
      btn.textContent = 'Running...';
      btn.disabled = true;

      try {
        const response = await fetch(`${API_BASE}/api/run-agent`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ agentName, task })
        });
        const result = await response.json();
        alert('Agent completed!\n\n' + (result.result || '').substring(0, 500));
        await fetchTasks();
      } catch (error) {
        console.error('Failed to run agent:', error);
        alert('Failed to run agent');
      } finally {
        btn.textContent = 'Run Agent';
        btn.disabled = false;
        document.getElementById('task-input').value = '';
      }
    };

    // Close modals on escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeAddTaskModal();
        closeAgentModal();
      }
    });

    // Close modal on overlay click
    document.getElementById('add-task-modal').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) closeAddTaskModal();
    });

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Initialize
    fetchAgents();
    fetchTasks();
    setInterval(fetchTasks, 30000); // Refresh every 30s
  </script>
</body>
</html>
